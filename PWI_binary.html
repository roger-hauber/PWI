<!-- PWI Experiment mit binärer button-press task (Vokal vs. Konsonant)-->

<!DOCTYPE html>
<html>
<!-- erstmal alle Plugins laden und die CSS Datei (übernommen aus CSI-Experiment) --- falls neue Plugins benutzt werden, nicht vergessen hier hinzuzufügen!-->
<head>
  <title> PWI </title>
  <script src = "jspsych_6_0_5/jspsych.js"></script>
  <script src = "jspsych_6_0_5/plugins/jspsych-html-keyboard-response.js"></script>
  <script src = "jspsych_6_0_5/plugins/jspsych-image-keyboard-response.js"></script>
  <script src = "jspsych_6_0_5/plugins/jspsych-html-button-response.js"></script>
  <script src = "jspsych_6_0_5/plugins/jspsych-survey-text.js"></script>
  <link href = "jspsych_6_0_5/css/jspsych.css" rel="stylesheet" type="text/css"></link>
</head>

<!-- hier im style-Tag können wir eventuelle custom Layout-Sachen anlegen (übernommen aus CSI: Layout für den <div> in dem die eingebettete EV-PDF präsentiert wird)-->
<style>

div.consent_form {
    position: relative;
    top:45%;
    left: 50%;
    height: 600px;
    width: 900px;
    margin: -300px 0 0 -450px;
/*border erstmal wieder auskommentiert -> nur für design und fein-Tuning relevant..
    border-width: 2px;
    border-style: solid;
    border-color: black;*/
  }

/*Ein 'container' für die Instruktionen mit Bild (also das <div> in dem dann das <div> mit dem Bild untergebracht ist..)*/
div.container_instructions {
  position: relative;
  top: 30%;
  height: 700px;
  width: 900px;
  border: 2px solid black;
}

/*jetzt den <div> für das Bild bei den Instruktionen selbst definieren..*/

div.image_instructions {
  position: absolute;
  width: 200px;
  height: 200px;
  top: 60%;
  left: 50%;
  margin-left: -100px;
  margin-top: -100px;
  border: 2px solid black;
}

</style>

<!-- leerer body -> Experiment wird in script-Tags erstellt-->
<script>
// consent form wird angezeigt mit einem Textfeld, in das die VP entweder einen target text zur Einwilligung bzw. einen target text zur Verweigerung einfügen soll..
      // im ersten <div> ist ein auskommentierter Rahmen formuliert -> für fein-Tuning falls man sehen möchte wo die Grenzen sind..
var get_consent = {
  type: "survey-text",
  questions: [{prompt: "<div style= 'height: 700px; width: 1000px; <!--border: 2px solid black-->'>Bitte lesen Sie sich die Einverständniserklärung aufmerksam durch!" +
               "<div class= 'consent_form'><embed src = 'img/Einverstaendniserklaerung.pdf' type= 'application/pdf' height= '600px' width= '900px'></embed></div></div>",
               placeholder: "Hier bitte Text einfügen..", rows: 4, columns: 70}],
  button_label: "Weiter.."
};

// Slide wenn Text für Einwilligung richtig eingefügt wird:
var text_consent_granted = {
  type: "html-button-response",
  stimulus: "Sie haben Ihre Einwilligung erteilt. Klicken Sie auf Weiter um Fortzufahren..",
  choices: ["Weiter"]
};

//slide wenn Text für Abbruch eingefügt wurde

var text_abbruch = {
  type: "html-keyboard-response",
  stimulus: "Sie haben Ihre Einwilligung NICHT erteilt! Sie können den Browser jetzt schließen..",
  choices: jsPsych.NO_KEYS
};

// Slide, der gezeigt wird bevor die EV nochmal angezeigt wird (für den Fall, dass kein valider input kommt..)

var text_repeat_consent = {
  type: "html-button-response",
  stimulus: "<p>Ihre Eingabe war ungültig.</p> <p>Bitte lesen Sie sich nochmal die Einverständniserklärung durch und fügen Sie den richtigen Text ein!</p>",
  choices: ["Zurück zur Einverständniserklärung.."]
};

// jetzt braucht es drei conditional prozeduren: 1. Einwilligung 2. Abbruch 3. Kein valider Text
// Einwilligung

var consent_granted = {
  timeline: [text_consent_granted],
  conditional_function: function(){
// Definiere was wir der Zieltext ist, den wir reinkopiert haben wollen
  var target_text_granted = "Ich erkläre hiermit meine freiwilligeEinwilligung zur Teilnahme an der geplanten Un-tersuchung und zur Verarbeitung meiner Daten im Rahmen der Studie Sprachprodukti-onsexperiment SSI-4wie im Informationsteil beschrieben";
  var text_response = JSON.parse(jsPsych.data.getLastTrialData().values()[0].responses).Q0;
  //var bool_test = text_response == "Ich erkläre hiermit meine freiwilligeEinwilligung zur Teilnahme an der geplanten Un-tersuchung und zur Verarbeitung meiner Daten im Rahmen der Studie Sprachprodukti-onsexperiment SSI-4wie im Informationsteil beschrieben";
  //console.log(text_response);
  //console.log(bool_test);
  if (text_response == target_text_granted){
    return true;
  } else {
    return false;
  }
 }
};

// Jetzt für den Fall dass EV verweigert wird (also der richtige Text dafür eingefügt wird..)
var consent_denied = {
  timeline: [text_abbruch],
  conditional_function: function(){
// Definiere was der Zieltext ist, den wir reinkopiert haben wollen
  var target_text_denied = "Ich willige nicht ein und möchte nicht an der Studie teilnehmen!";
  var text_response = JSON.parse(jsPsych.data.getLastTrialData().values()[0].responses).Q0;
  if (text_response == target_text_denied){
    return true;
  } else {
    return false;
  }
 }
};

// für den Fall, dass kein valider Text eingegeben wurde..

var repeat_consent = {
  timeline: [text_repeat_consent, get_consent],
  conditional_function: function(){
// Definiere was der Zieltext ist, den wir reinkopiert haben wollen
  var target_text_denied = "Ich willige nicht ein und möchte nicht an der Studie teilnehmen!";
  var target_text_granted = "Ich erkläre hiermit meine freiwilligeEinwilligung zur Teilnahme an der geplanten Un-tersuchung und zur Verarbeitung meiner Daten im Rahmen der Studie Sprachprodukti-onsexperiment SSI-4wie im Informationsteil beschrieben";
  var text_response = JSON.parse(jsPsych.data.getLastTrialData().values()[0].responses).Q0;
  if (text_response != target_text_denied && text_response != target_text_granted){
    return true;
  } else {
    return false;
  }
 }
};

// wenn consent gegeben wurde und text_consent_granted gezeigt wurde geht es weiter mit demographics

var demographics = {
  type: "survey-text",
  questions: [
    {prompt: "Geben Sie bitte Ihr Geschlecht an!", placeholder: "m/w/d", required: true},
    {prompt: "Wie alt sind Sie?", placeholder: "Alter", required: true},
    {prompt: "Sind Sie deutsche/-r Muttersprachler/-in?", placeholder: "ja/nein", required: true}
    ],
  preamble: "Zunächst benötigen wir einige demopraphische Angaben..<br></br>Bitte füllen Sie hierfür die Textfelder unten aus!",
  button_label: "Zum Fortfahren hier klicken.."
};

// Jetzt kommen die Instuktionen zum eigentlichen Experiments
// zunächst einfach kurz beschrieben, was gemacht werden muss, dann weiter zu einem Beispiele
    // issues: fürs Beispiel nur Bild oder Bild+Distraktor?
var instructions_1 = {
  type: "html-button-response",
  stimulus: "<div>Im folgenden Experiment werden Sie eine Reihe von Zeichnungen bekannter Dinge sehen.<br></br>Ihre Aufgabe ist es jeweils anzugeben,"+
            " ob der <b>letzte Buchstabe</b> des Wortes für das Bild ein <b>Vokal</b> oder ein <b>Konsonant</b> ist." +
            "<br></br>Drücken Sie bitte die Taste <b>Q</b> auf Ihrer Tastatur, wenn das Wort mit einem <b>Vokal endet</b> " +
            "und drücken Sie bitte die Taste <b>P</b>, wenn das Wort mit einem <b>Konsonanten endet</b>!<br></br>" +
            /*"<div style= 'float: left'><br></br>Taste <b>D</b><br></br>Vokal</div><div style= 'float:right'><br></br>Taste <b>K</b><br></br>Konsonant</div><br></br>*/"Auf der nächsten Seite folgen ein paar Beispiele!<br></br><br></br><br></br></div>",
  choices: ["Klicken Sie hier um fortzufahren.."]
};

var instructions_2 = {
  type: "html-button-response",
  stimulus: "<div class= 'container_instructions'>Hier nun ein Beispiel für Ihre Aufgabe im Experiment...<br></br>" +
            "<div class= 'image_instructions'><img src = 'img/kuh.png'></img></div></div>"
            /*"<div style= 'float: left'><br></br>Taste <b>D</b><br></br>Vokal</div><div style= 'float:right'><br></br>Taste <b>K</b><br></br>Konsonant</div><br></br>"Auf der nächsten Seite folgen ein paar Beispiele!<br></br><br></br><br></br></div>"*/,
  choices: ["Klicken Sie hier um fortzufahren.."]
};



jsPsych.init({
  timeline: [/*get_consent, consent_granted, consent_denied, repeat_consent, consent_denied, consent_granted, demographics,*/ instructions_1, instructions_2],
  /*on_finish: function() {
        jsPsych.data.get().localSave('csv','trialrun.csv');
    },*/
  //preload_images: bilder
});
</script>

<body></body>



</html>
